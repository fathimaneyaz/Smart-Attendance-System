python
import face_recognition
import os
import pickle

known_encodings = []
known_names = []

path = "known_faces"

for file in os.listdir(path):
    img = face_recognition.load_image_file(f"{path}/{file}")
    encoding = face_recognition.face_encodings(img)[0]
    known_encodings.append(encoding)
    known_names.append(os.path.splitext(file)[0])

with open("faces.pkl", "wb") as f:
    pickle.dump((known_encodings, known_names), f)

print("Training completed!")

from flask import Flask, request, jsonify
import cv2
import face_recognition
import pickle
import sqlite3
import datetime
import numpy as np
import base64

app = Flask(__name__)

with open("faces.pkl", "rb") as f:
    known_encodings, known_names = pickle.load(f)

def mark_attendance(name):
    conn = sqlite3.connect("attendance.db")
    cur = conn.cursor()
    cur.execute("""
        CREATE TABLE IF NOT EXISTS attendance(
            name TEXT,
            date TEXT,
            time TEXT
        )
    """)
    now = datetime.datetime.now()
    cur.execute("INSERT INTO attendance VALUES (?,?,?)",
                (name, now.date(), now.strftime("%H:%M:%S")))
    conn.commit()
    conn.close()

@app.route("/attendance", methods=["POST"])
def attendance():
    data = request.json["image"]
    img_bytes = base64.b64decode(data.split(",")[1])
    np_img = np.frombuffer(img_bytes, np.uint8)
    frame = cv2.imdecode(np_img, cv2.IMREAD_COLOR)

    rgb = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    faces = face_recognition.face_locations(rgb)
    encodings = face_recognition.face_encodings(rgb, faces)

    present_students = []

    for encoding in encodings:
        matches = face_recognition.compare_faces(known_encodings, encoding)
        if True in matches:
            name = known_names[matches.index(True)]
            mark_attendance(name)
            present_students.append(name)

    return jsonify({"present": present_students})

if __name__ == "__main__":
    app.run(debug=True)